#include "Common.h"
#include "FileSys.h"

namespace {

    // Вычисление для индекса k = 0
    BmpVector calculateK0(size_t N) {
        BmpVector B0;
        for (size_t i = 0; i <= N; ++i) {
            BmpReal value = (1 + pow(-1.0, i))/(2*(i+1));
            B0.push_back(value);
        }
        return B0;
    }

    // Вычисление по реккурентной формуле
    BmpVector calculateBk(const BmpVector& Bkm1) {
        BmpVector Bk;
        size_t N = Bkm1.size();
        BmpReal value = 0;
        for (size_t i = 0; i < N; ++i) {
            value += Bkm1.at(i);
            Bk.push_back(value / (i + 1));
        }
        return Bk;
    }
}

TEST_CASE("k0") {
    size_t N = 67;
    BmpVector b0 = calculateK0(N);
    filesys::writeFile("b0.txt", b0);
}

TEST_CASE("k1") {
    const BmpVector BK0 = {
        1.00000000000000000, 0.00000000000000000, 0.33333333333333331, 0.00000000000000000, 0.20000000000000001, 0.00000000000000000, 0.14285714285714285,
        0.00000000000000000, 0.11111111111111110, 0.00000000000000000,0.09090909090909091, 0.00000000000000000, 0.07692307692307693,0.00000000000000000,
        0.06666666666666667, 0.00000000000000000, 0.05882352941176471, 0.00000000000000000, 0.05263157894736842, 0.00000000000000000, 0.04761904761904762,
        0.00000000000000000, 0.04347826086956522, 0.00000000000000000, 0.04000000000000000, 0.00000000000000000, 0.03703703703703703, 0.00000000000000000,
        0.03448275862068965, 0.00000000000000000, 0.03225806451612903, 0.00000000000000000, 0.03030303030303030, 0.00000000000000000, 0.02857142857142857,
        0.00000000000000000, 0.02702702702702703, 0.00000000000000000, 0.02564102564102564, 0.00000000000000000, 0.02439024390243903, 0.00000000000000000,
        0.02325581395348837, 0.00000000000000000, 0.02222222222222222, 0.00000000000000000, 0.02127659574468085, 0.00000000000000000, 0.02040816326530612,
        0.00000000000000000, 0.01960784313725490, 0.00000000000000000, 0.01886792452830189, 0.00000000000000000,0.01818181818181818, 0.00000000000000000,
        0.01754385964912281, 0.00000000000000000, 0.01694915254237288, 0.00000000000000000,0.01639344262295082, 0.00000000000000000, 0.01587301587301587,
        0.00000000000000000, 0.01538461538461539, 0.00000000000000000, 0.01492537313432836,0.00000000000000000,
    };
    BmpVector bk1 = calculateBk(BK0);
    filesys::writeFile("b1.txt", bk1);
}

TEST_CASE("k2") {
    const BmpVector BK1 = {
        1.00000000000000000, 0.50000000000000000, 0.44444444444444442, 0.33333333333333331, 0.30666666666666664, 0.25555555555555554, 0.23945578231292514,
        0.20952380952380950, 0.19858906525573192, 0.17873015873015871, 0.17074642529187981, 0.15651755651755650, 0.15039490424105806, 0.13965241108098250,
        0.13478669478669478, 0.12636252636252635, 0.12238964418895212, 0.11559021951178811, 0.11227660685050288, 0.10666277650797773, 0.10385117037040963,
        0.09913066262630009,0.09671099298470294, 0.09268136827700697, 0.09057411354592670, 0.08709049379416028, 0.08523666206241499, 0.08219249556018589,
        0.08054733221744463, 0.07786242114352980, 0.07639131286522656, 0.07400408433818823, 0.07267980997348647, 0.07054216850367805, 0.06934300450561377,
        0.06741680993601339, 0.06632519418171647, 0.06457979433482919, 0.06358136436832140, 0.06199183025911337,0.06107471839675545, 0.05962055843492794,
        0.05877486670280144, 0.05743907427773778, 0.05665647756539299, 0.05542481500962358, 0.05469825715292267, 0.05355871012890345, 0.05288216835617696,
        0.05182452498905343, 0.05119282534490051, 0.05020834793442165, 0.04961701919090997, 0.04869818550218941, 0.04814334246000084, 0.04728363991607226,
        0.04676188938507314, 0.04595564991291671, 0.04546401436426342, 0.04470628079152570, 0.04424213590351627, 0.04352855306636278, 0.04308957628551600,
        0.04241630165605482, 0.04200042955957113, 0.04136405941472915,0.04096945215681271, 0.04036696021333017,
    };
    BmpVector bk2 = calculateBk(BK1);
    filesys::writeFile("bk2.txt", bk2);
}

TEST_CASE("k3") {
    const BmpVector BK2 = {
        1.00000000000000000, 0.75000000000000000, 0.64814814814814814, 0.56944444444444442, 0.51688888888888884, 0.47333333333333333, 0.43992225461613216,
        0.41112244897959183, 0.38750762856582965, 0.36662988158226251, 0.34882229464677317, 0.33279689980267180, 0.31876597706716309, 0.30597215092529301,
        0.29455978718271980, 0.28404745838145773, 0.27453817519366330, 0.26570773321133689, 0.25763241077129301, 0.25008392905812726, 0.24312046435871212,
        0.23657547337087523, 0.23049440900625906, 0.22475219897587354, 0.21938507555867567, 0.21429682241388662, 0.20951681647494322, 0.20496951929941615,
        0.20067909905521025, 0.19658520979148755, 0.19270798730999525, 0.18899849034212629, 0.18547368184610691, 0.18209334321838841, 0.17887190496945199,
        0.17577593010741202, 0.17281780210942027, 0.16996943348377314, 0.16724153427568461, 0.16461029167527036, 0.16208503379042852, 0.15964540342482136,
        0.15729957698942557, 0.15503002010961447, 0.15284394138640955, 0.15072613429126203, 0.14868298796916971, 0.14670123218083084, 0.14478655740889912,
        0.14292731676050219, 0.14112860124254922, 0.13938013483277753, 0.13768649114142154, 0.13603855955550984, 0.13444046469922785, 0.13288409282810007,
        0.13137317697822240, 0.12990046099433783, 0.12846933478026876, 0.12707328388045638, 0.12571539620870326,0.12438980196447197, 0.12309932219179014, 0.12183864999591927,
        0.12061036968151391, 0.11940966801080505, 0.11823891852044695, 0.11709374266298934,
    };

    BmpVector bk3 = calculateBk(BK2);
    filesys::writeFile("bk3.txt", bk3);
}

TEST_CASE("k4") {
    const BmpVector BK3 = {
        1.00000000000000000, 0.87500000000000000, 0.79938271604938260, 0.74189814814814814, 0.69689629629629635, 0.65963580246913578, 0.62824815277584956,
        0.60110743980131731, 0.57737412744181871, 0.55629970285586317, 0.53743812029140037, 0.52038468525067294, 0.50487555385194149, 0.49066816792860946,
        0.47759427587888342, 0.46549759978529431, 0.45426469245637480, 0.44378930583165049, 0.43399157451268427, 0.42479619223995640, 0.41614496710275428, 0.40798271738766889,
        0.40026583441456409, 0.39295276627128528, 0.38601005864278087, 0.37940570340320801, 0.37311352240586487, 0.36710837943777747, 0.36136943873493027,
        0.35587663110348217, 0.35061312646498266, 0.34556266908614336, 0.34071148765462711, 0.33604624811238482, 0.33155555259401526, 0.32722834085827629,
        0.32305508305425318, 0.31902651332871423, 0.31513459078889294, 0.31137148331105235, 0.30773035039591523, 0.30420451832517487, 0.30078812434062258,
        0.29747544015355420, 0.29426140684761770, 0.29114107483552298, 0.28811005171070697, 0.28516403463716788, 0.28229918816312161, 0.27951175073506923,
        0.27679835564698058, 0.27415569755439972, 0.27158080686736241, 0.26907076525047624, 0.26662294160408995, 0.26423474787594725, 0.26190384312335557,
        0.25962792274182078, 0.25740489582721821, 0.25523270229477218, 0.25310946776877102, 0.25103334412676620, 0.24900264536589356, 0.24701570793823771,
        0.24507101042659579, 0.24316705069302325, 0.24130245170537284, 0.23947585304298483,
    };

    BmpVector bk4 = calculateBk(BK3);
    filesys::writeFile("bk4.txt", bk4);
}