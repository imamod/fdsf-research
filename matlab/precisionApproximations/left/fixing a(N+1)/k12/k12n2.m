%% В этом файле значения z и I правильно аппроксимируются, т.е 
% z = (Ik/(k!*y))^(1/k)
%
clc 
clear all 
close all
format long

% коэффициент k функции Ферми-Дирака
k = 1/2;

N = 2;
% x_star = 2;
x_star = 3;
y_star = log(1+exp(x_star));

a0 = 1; b0 = 1;
a = zeros(1,N+1); b = zeros(1,N);

% задаем лин-триг сетку 
j = 1:2*N;
alpha = 2/(2+pi);
y0 = 0.5*y_star*(2*alpha*j/(2*N)+(1-alpha)*(1 - cos(pi*j/(2*N))));
x0 = log(exp(y0)-1);

%Y = [0.03610504313396451014928679103584471463600509974254993615580087134537711514711105
%0.07221008626792902029857358207168942927201019948509987231160174269075423029422210
%0.10831512940189353044786037310753414390801529922764980846740261403613134544133315
%0.14442017253585804059714716414337885854402039897019974462320348538150846058844420
%0.18052521566982255074643395517922357318002549871274968077900435672688557573555525
%0.21663025880378706089572074621506828781603059845529961693480522807226269088266630
%0.25273530193775157104500753725091300245203569819784955309060609941763980602977735
%0.28884034507171608119429432828675771708804079794039948924640697076301692117688840
%0.32494538820568059134358111932260243172404589768294942540220784210839403632399945
%0.36105043133964510149286791035844714636005099742549936155800871345377115147111050
%0.39715547447360961164215470139429186099605609716804929771380958479914826661822155
%0.45772897729614385133121912882927916597070250028042443566856189974140245525458518
%0.51830248011867809102028355626426647094534890339279957362331421468365664389094881
%0.57887598294121233070934798369925377591999530650517471157806652962591083252731244
%0.63944948576374657039841241113424108089464170961754984953281884456816502116367607
%0.70002298858628081008747683856922838586928811272992498748757115951041920980003970
%0.76059649140881504977654126600421569084393451584230012544232347445267339843640333
%0.82116999423134928946560569343920299581858091895467526339707578939492758707276696
%0.88174349705388352915467012087419030079322732206705040135182810433718177570913059
%0.94231699987641776884373454830917760576787372517942553930658041927943596434549422
%1.00289050269895200853279897574416491074252012829180067726133273422169015200000000
%1.06346400552148624822186340317915221571716653140417581521608504916394434000000000
%1.12403750834402048791092783061413952069181293451655095317083736409701981000000000
%1.18461101116655472759999225804912682566645933762892609112558967903009528000000000
%1.24518451398908896728905668548411413064110574074130122908034199396317075000000000
%1.30575801681162320697812111291910143561575214385367636703509430889624622000000000
%1.36633151963415744666718554035408874059039854696605150498984662382932169000000000
%1.42690502245669168635624996778907604556504495007842664294459893876239716000000000
%1.48747852527922592604531439522406335053969135319080178089935125369547263000000000
%1.54805202810176016573437882265905065551433775630317691885410356862854810000000000
%1.60862553092429440542344325009403796048898415941555205680885588356162357000000000
%1.66919903374682864511250767752902526546363056252792719476360819849469904000000000
%1.72977253656936288480157210496401257043827696564030233271836051342777451000000000
%1.76587757970332739495085889599985728507428206538285226887416138478233034300000000
%1.80198262283729190510014568703570199971028716512540220502996225613688617600000000
%1.83808766597125641524943247807154671434629226486795214118576312749144200900000000
%1.87419270910522092539871926910739142898229736461050207734156399884599784200000000
%1.91029775223918543554800606014323614361830246435305201349736487020055367500000000
%1.94640279537314994569729285117908085825430756409560194965316574155510950800000000
%1.98250783850711445584657964221492557289031266383815188580896661290966534100000000
%2.01861288164107896599586643325077028752631776358070182196476748426422117400000000
%2.05471792477504347614515322428661500216232286332325175812056835561877700700000000
%2.09082296790900798629444001532245971679832796306580169427636922697333284000000000
%2.12692801104297249644372680635830443143433306280835163043217009832788867300000000
%]';

Y = [0.05175040116767015
0.10350080233534030
0.15525120350301044
0.20700160467068060
0.25875200583835073
0.31050240700602089
0.36225280817369104
0.41400320934136120
0.46575361050903136
0.51750401167670146
0.56925441284437162
0.65607616402096247
0.74289791519755333
0.82971966637414418
0.91654141755073504
1.00336316872732589
1.09018491990391664
1.17700667108050738
1.26382842225709813
1.35065017343368887
1.43747192461027962
1.52429367578687036
1.61111542696346133
1.69793717814005229
1.78475892931664326
1.87158068049323423
1.95840243166982519
2.04522418284641594
2.13204593402300668
2.21886768519959743
2.30568943637618817
2.39251118755277892
2.47933293872936966
2.53108333989703960
2.58283374106470953
2.63458414223237947
2.68633454340004940
2.73808494456771934
2.78983534573538927
2.84158574690305921
2.89333614807072914
2.94508654923839908
2.99683695040606901
3.04858735157373895
]';

X = log(exp(Y)-1); 

% z = (Ik/(k!*y))^(1/k)
%z = [0.37272985481997593473399598968986957896526279458801511519561563931759119271875000
%1.09412205187797737295110530457462039973370163959440048727825710615496088700000000
%1.93935142507802740322576474377585994735170216909913577276799773652868298700000000
%2.50245782600714033291846822160422263260046444801055720300554881032916361700000000
%]';
I_base = [0.54736921874898470
1.66538357256125846
3.03886654060988315
3.97698535404797671
]';

z = (I_base./(gamma(k+1)*y0)).^(1/k);

I_add = [0.04621085405377932
0.09312088274331431
0.14073397824966585
0.18905389225904284
0.23808423442931415
0.28782847103114784
0.33828992376526246
0.38947176875679018
0.44137703572728471
0.49400860734442320
0.54736921874898470
0.63853704234531283
0.73177538466280478
0.82709435808615317
0.92450290999736007
1.02400883165332401
1.12561877058328252
1.22933824634686739
1.33517166947414001
1.44312236339196853
1.55319258912669800
1.66538357256125780
1.77969553401569858
1.89612771991363149
2.01467843629307497
2.13534508391875910
2.25812419475379356
2.38301146955172882
2.51000181633505592
2.63908938953325567
2.77026762956192174
2.90352930263457409
3.03886654060988137
3.12051858017358219
3.20290314238935192
3.28601827280669534
3.36986195273837197
3.45443210214144658
3.53972658246551930
3.62574319946482415
3.71247970597115051
3.79993380462476615
3.88810315056069067
3.97698535404797093
]';
%I = [0.03216667634423829230889126395445115654557312301271788098319727600466655153906250
%0.06467309455034026880649619330734628775571268284293835120838911463246055735937500
%0.09752059787490123082224040361030846794359834184234423540366642032917264939843750
%0.13071049652342929184121867633996320053217571808684842374133088213977099578906250
%0.16424406737521376227058262455479277934583253485010786946143858931029316812500000
%0.19812255372813700622023895716103209107042756826789152263571083604444219446093750
%0.23234716506358953539511309558182324895031728736445073872561406903660049046875000
%0.26691907683162147103857647211097347503310960087559336777031156462786525315625000
%0.30183943025643674352524824845600450062329272007584393889159799541514363550781250
%0.33710933216230957201120731145832708985567253222689532028824128773770111125781250
%0.37272985481997593473399598968986957896526279458801511519561563931759119271875000
%0.43328087941623197152362006735358121427061328188671525615899123668686269292968750
%0.49482637575705230346922124832502142931572360424288169093051692386354692693750000
%0.55737074653705564136338734988350376637967149307378230927575586547731097962500000
%0.62091811699294655782236611498875888761093113690808354773951219221761911377343750
%0.68547233467460696664853517592752827631945927202453335987913304675313582575781250
%0.75103696966068711975076784505937308424061127460776541199981020823642417346875000
%0.81761531521166948490926982510143781977516593181155620972986372447023521401562500
%0.88521038885192283910367272631412636980282554830307359042557303731093561667187500
%0.95382493387087350597129480393049180795809162618465009342111025404646139074218750
%1.02346142123210651919287123454921071889190645604716808065686532195942816500000000
%1.09412205187797737295110530457462039973370163959440048727825710615496088700000000
%1.16580875941617070436916338779002860098791101897494496469659900237397237800000000
%1.23852321317359056815335685577094836897368515599799894268878350279635981500000000
%1.31226682160201223499730074219828007031790745794253875236864802936058418100000000
%1.38704073601906950770785965209618747843294165184341485188271922128360525800000000
%1.46284585466739966741629742447199146340440878751005981938284960760966337500000000
%1.53968282707411725861662119219453109751371906044153601730863367722542448100000000
%1.61755205869224295259091209450383159339082177185117484005381862213386863000000000
%1.69645371580527155921860661676547393028105924558502391638733269483128991500000000
%1.77638773067572403612797582336350075646632308510637854346187372293541492200000000
%1.85735380691829000622299740124284187487532431584832039465330040859199598600000000
%1.93935142507802740322576474377585994735170216909913577276799773652868298700000000
%1.98871676086288177560373270341904320068614844270715849606710293894494018800000000
%2.03844813285241960737817034169835514760942217767432052648677639248438325500000000
%2.08854532287105087277388775454171389851864129163234808768161388843045640100000000
%2.13900808697702813848555375835156507142059041511549204944859819182658954400000000
%2.18983615592928069900828472628148958944190596698896421179081586352803030200000000
%2.24102923565928947921773790435174032294411204870895133319574814675156697600000000
%2.29258700774750314294514730762604204750518251960571636071261136653809949300000000
%2.34450912990380214604695415003935248654505061099021033224411409713390161100000000
%2.39679523645152439818769817950211109586012435422221600269340459519649714000000000
%2.44944493881457371646996971224321847070259124382438679235183287309469359500000000
%2.50245782600714033291846822160422263260046444801055720300554881032916361700000000
%]';

I = (I_add./(gamma(k+1)*Y)).^(1/k);

% Задаем матрицы A и B
% B = z(1,:) - (gamma(k+1))*y0.*ones(1,2*N);
B = z(1,:) - ones(1,2*N);
A = zeros(2*N,2*N);
for i = 1:size(A,2)
    for j = 1:size(A,2)
        if (j>=1 && j<=N)
            A(i,j) = (y0(i))^(j);
        elseif (j >= N+1 && j <=2*N-1)
            A(i,j) = -z(i)*y0(i)^(j-N);
        elseif (j == 2*N)
            A(i,j) = -z(i)*y0(i)^N + (gamma(k+2)^(-1/k))*(y0(i)^(N+1));
        end
    end
end
disp(A); 
disp(B');
E = A\B';
disp(E);

for j = 1:length(E)
    if (j>=1 && j<=N)
        a(j) = E(j);
    elseif (j >= N+1 && j <=2*N)
        b(j-N) = E(j);
    end
end
a(N+1) = b(N)*gamma(k+2)^(-1/k);
disp('lg(cond(A)):'); disp(log10(cond(A)));
disp('--------------------------------');
disp('Коэффициенты а:'); disp(a);
disp('----------------------------');
disp('Коэффициенты b:'); disp(b);
disp('----------------------------');

F_base = zeros(1,2*N);
delta_base = zeros(1,2*N);
for j = 1:2*N
    S1 = 0; S2 = 0; 
    for n = 1:N+1 
        S1 = S1 + a(n).*y0(j).^n;
    end
    for m = 1:N
        S2 = S2 + b(m).*y0(j).^m;
    end
    F_base(j) = (a0 + S1)/(b0 + S2);
%    F_base(j) = gamma(k+1)*y0(j)*((a0 + S1)/(b0 + S2))^k;
    delta_base(j) = F_base(j)/z(j)-1;
end
%---------------------------------------
% Добавим вспомогательную сетку

F = zeros(1,length(Y));
delta_additional = zeros(1,length(Y));
for j = 1:length(Y)
    S1 = 0; S2 = 0; 
    for n = 1:N+1 
        S1 = S1 + a(n).*Y(j).^n;
    end
    for m = 1:N
        S2 = S2 + b(m).*Y(j).^m;
    end
    F(j) = (a0 + S1)/(b0 + S2);
%     F(j) = gamma(k+1)*Y(j)*((a0 + S1)/(b0 + S2))^k;
    delta_additional(j) = F(j)/I(j)-1;
end

disp('lg(dc):');disp(log10(max(abs(delta_additional))));

grid on, hold on
xlabel('y'); %ylabel('d*10^1^0');
plot(Y,delta_additional, 'k','linewidth', 2.5);
plot(y0,delta_base, 'k*','linewidth',5)
% axis([0 y_star -1.5*10^(-1) 1.5*10^(-1)])
line([0;y_star],[0; 0],'linewidth', 2, 'color', 'black');
line([0;log(1+exp(x_star))],[0; 0],'linewidth', 2, 'color', 'black');
% line([0;0],[-1.25; 1.35],'linewidth', 3, 'color', 'black');
% title({'Линейно-тригонометрическая сетка';['k = ', num2str(k), ', N = ', num2str(N), ', x_d_i_v = ', num2str(x_div)]})
% plot(log(1+exp(x_div)),2*10^-16,'b*');