clc 
clear all 
close all
format long

% коэффициент k функции Ферми-Дирака
k = 1/2;

N = 10;
baseSize = N;
x_star = 3;
y_star = log(1+exp(x_star));

y_star_inv = 1/(y_star^2);

a = zeros(1,N); b = zeros(1,N);

% задаем лин-триг сетку 
j = 1:baseSize;
y0_inv = y_star_inv*((sin(pi*j/(2*baseSize))).^2);
y0 = 1./sqrt(y0_inv(end:-1:1));
x0 = log(exp(y0)-1);

Y = [3.04858735157374294
3.05198412217210135
3.05539227229216470
3.05881186561373086
3.06224296631661064
3.06568563908568636
3.06913994911603316
3.07260596211810366
3.07608374432298248
3.07957336248769709
3.08307488390060058
3.08658837638682426
3.09685334613713348
3.10722141548875630
3.11769432193697993
3.12827384424920130
3.13896180373401767
3.14976006555833843
3.16067054011468729
3.17169518444096399
3.18283600369506692
3.19409505268689253
3.20547443747037519
3.22344303811645050
3.24171724079323820
3.26030580746880450
3.27921785589573034
3.29846287840373042
3.31805076191990578
3.33799180931254202
3.35829676216312967
3.37897682508093089
3.40004369168513376
3.42150957239145770
3.44914612539517718
3.47746336822786262
3.50648971007402066
3.53625524827576010
3.56679189953883480
3.59813354382153028
3.63031618238122178
3.66337811165489269
3.69736011488318628
3.73230567365830845
3.76826120189119562
3.80935869335437705
3.85183085257440938
3.89575606445182476
3.94121911750250309
3.98831189255759311
4.03713414421074734
4.08779439014485568
4.14041092639256014
4.19511299016345784
4.25204209627519525
4.31135357867466240
4.37321837531396262
4.43782510312721357
4.50538248053099455
4.57612216839880048
4.65030211771625712
4.72821053429665294
4.81017059964529992
4.89654612453724969
4.98774836122000220
5.08424426573652166
5.18656658989601738
5.28437699008833306
5.38793829619386155
5.49783709499310902
5.61474730652368592
5.73944764574719102
5.87284355022097593
6.01599498965447310
6.17015211778917649
6.33680152182913492
6.51772700553628237
6.71509063146191210
6.88515442627025642
7.06883012233276098
7.26803615429046257
7.48509216362083940
7.72283375175387210
7.98477007951945161
8.27530460095842102
8.60005117792748663
8.96629845274904547
9.38371234710703384
9.86543590503867840
10.21687004821468392
10.60875230794623114
11.04948883320554920
11.55015425379860794
12.12568992580823490
12.79683306492733408
13.59336973705259410
14.55993944771365811
15.76715318273960698
17.33493178607497853
19.48795203659068775
20.43913652869184006
21.54474161260456100
22.85164933977701907
24.42944072918415443
26.38681179549439193
28.90530408207134272
32.31711241890683795
37.31658710897452380
45.70329867955403813
64.63422483781367589
]';

X = log(exp(Y)-1); 

I_base = [3.97698535404797671
4.04270528019665232
4.25077286027390144
4.63833721459645609
5.28552865749687673
6.35962395754328824
8.23844562215976239
11.92282551301395266
20.92207998459994300
57.53999573548961166
]';

C1 = (k+1)*k*(pi^2)/6;
z = ((I_base*(k+1)./(y0.^(k+1))).^(2/k) - 1).*(y0.^2)*k/(2*C1);

I_add = [3.97698535404797804
3.98284423831681833
3.98872582586832625
3.99463025683609763
4.00055767253754446
4.00650821548659497
4.01248202940654508
4.01847925924309113
4.02450005117751708
4.03054455264006162
4.03661291232345487
4.04270528019665321
4.06052336448250184
4.07854869269725206
4.09678512031926356
4.11523660142383907
4.13390719189738665
4.15280105277915546
4.17192245373660597
4.19127577668063722
4.21086551952743893
4.23069630011388487
4.25077286027390144
4.28254390804393292
4.31494209865136291
4.34798730445215842
4.38170026717588357
4.41610264663464136
4.45121707277206546
4.48706720132431425
4.52367777339072941
4.56107467924017485
4.59928502671086559
4.63833721459645432
4.68879077139873512
4.74069124286530297
4.79410546353571476
4.84910454990310402
4.90576425358390189
4.96416535033651218
5.02439406927429033
5.08654256723335685
5.15070945397152258
5.21700037470899325
5.28552865749687673
5.36425524166832624
5.44605998062594221
5.53113740423167055
5.61969918636421362
5.71197610220010521
5.80822026236955136
5.90870767109153405
6.01374116482699606
6.12365379961354162
6.23881276964012876
6.35962395754329002
6.48653723934805626
6.62005269524375350
6.76072791321377409
6.90918661825423097
7.06612891865728265
7.23234353687628406
7.40872249170495412
7.59627882904602902
7.79616817185023780
8.00971509208974375
8.23844562215976239
8.45927496226096309
8.69539592913301185
8.94853971595571984
9.22071567060809016
9.51427037068560111
9.83196258897791076
10.17705941240032885
10.55346088195592102
10.96586362779883927
11.41997864397814411
11.92282551301395266
12.36228498060202341
12.84324424844639090
13.37219573585189636
13.95709828601727587
14.60782339844419297
15.33677707870691442
16.15978440805881533
17.09737747568038913
18.17672121940830010
19.43458309476092438
20.92207998459993590
22.03094168880809534
23.29048686061520357
24.73553426696241786
26.41287656832487940
28.38702317127394181
30.74965247572176352
33.63594296592668087
37.25451389483565379
41.94655452062453804
48.31439689606767729
57.53999573548961166
61.78540633196989518
66.84602881970064914
72.99810882090653763
80.66352418144859371
90.52299731091977719
103.75678783131485261
122.62265153287167152
152.10603543527648185
206.10408459762291500
346.52200531267612860
]';

I = (((I_add*(k+1)./(Y.^(k+1))).^(2/k) - 1).*(Y.^2))*k/(2*C1);

% Задаем матрицы A и B
B = (z(1,:) - ones(1,baseSize));
A = zeros(baseSize,baseSize);
for i = 1:baseSize
    for j = 1:baseSize
        A(i,j) = y0(i)^(-2*j);
    end
end
disp(A); 
disp(B');
E = A\B';
disp(E);

for j = 1:length(E)
    a(j) = E(j);
end
disp('lg(cond(A)):'); disp(log10(cond(A)));
disp('--------------------------------');
disp('Коэффициенты а:'); disp(a');
disp('----------------------------');

F_base = zeros(1,baseSize);
delta_base = zeros(1,baseSize);
for j = 1:baseSize
    S1 = 0; 
    for n = 1:N
        S1 = S1 + a(n).*y0(j).^(-2*n);
    end
    F_base(j) = 1 + S1;
    delta_base(j) = F_base(j)/z(j)-1;
end
%---------------------------------------
% Добавим вспомогательную сетку

F = zeros(1,length(Y));
delta_additional = zeros(1,length(Y));
for j = 1:length(Y)
    S1 = 0;
    for n = 1:baseSize
        S1 = S1 + a(n).*Y(j).^(-2*n);
    end
    F(j) = 1 + S1;
    delta_additional(j) = F(j)/I(j)-1;
end

% disp((I-F)');

disp('lg(dc):');disp(log10(max(abs(delta_additional))));
disp('-------------------');
disp('Экстремумы:');
span = 11;
disp(max(abs(delta_additional(1:span))));
for i=1:baseSize-1 
    disp(max(abs(delta_additional((i*span):(i+1)*span))));
end
disp('-------------------');

figure
grid on, hold on
xlabel('y'); %ylabel('d*10^1^0');
plot(Y,delta_additional, 'k','linewidth', 2.5);
plot(y0,delta_base, 'k*','linewidth',5)
