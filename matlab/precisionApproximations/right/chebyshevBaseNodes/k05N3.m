clc 
clear all 
close all
format long

% коэффициент k функции Ферми-Дирака
k = 1/2;

N = 3;
baseSize = N;
x_star = 3;
y_star = log(1+exp(x_star));

y_star_inv = 1/(y_star^2);

a = zeros(1,N); b = zeros(1,N);

% задаем лин-триг сетку 
j = 1:baseSize;
y0_inv = y_star_inv*((sin(pi*j/(2*baseSize))).^2);
y0 = 1./sqrt(y0_inv(end:-1:1));
x0 = log(exp(y0)-1);

Y = [3.04858735157374205
3.08383230687462495
3.12032863412584494
3.15815218036347645
3.19738538875014910
3.23811805492538962
3.28044819213102778
3.32448302409651131
3.37034012859779564
3.41814875948001928
3.46805138102125898
3.52020545615837710
3.63198574037859867
3.75513869970993630
3.89173356101307055
4.04440815431735423
4.21658698252569231
4.41281107344188506
4.63925432397400073
4.90456529804700736
5.22130847564553058
5.60858499203688332
6.09717470314748411
6.39477077750029821
6.74068025719559127
7.14957107950992654
7.64321298340390154
8.25561357469083745
9.04357156180806498
10.11102038579338824
11.67520068303921299
14.29914215901985308
20.22204077158677649
]';

X = log(exp(Y)-1); 

I_base = [3.97698535404797671
4.81942042503810342
10.37466055155188727
]';

C1 = (k+1)*k*(pi^2)/6;
z = ((I_base*(k+1)./(y0.^(k+1))).^(2/k) - 1).*(y0.^2)*k/(2*C1);

I_add = [3.97698535404797671
4.03792600149001224
4.10137679619248363
4.16750606219000908
4.23649792045401519
4.30855421382905845
4.38389672313587475
4.46276972749748602
4.54544297334555480
4.63221513080864700
4.72341783408510185
4.81942042503810342
5.02752578114569104
5.26048052049125126
5.52332633550864482
5.82260990212501373
6.16700019988721682
6.56824090910323921
7.04267345991409410
7.61377848919971978
8.31663977275216482
9.20629561049573297
10.37466055155188371
11.11064459779278302
11.98858844044904792
13.05672278606514247
14.38872884543851427
16.10352981695412566
18.40737224734298749
21.69488436865299619
26.83765673300464627
36.26584742434106090
60.80751911700512835
]';

I = (((I_add*(k+1)./(Y.^(k+1))).^(2/k) - 1).*(Y.^2))*k/(2*C1);

% Задаем матрицы A и B
B = (z(1,:) - ones(1,baseSize));
A = zeros(baseSize,baseSize);
for i = 1:baseSize
    for j = 1:baseSize
        A(i,j) = y0(i)^(-2*j);
    end
end
disp(A); 
disp(B');
E = A\B';
disp(E);

for j = 1:length(E)
    a(j) = E(j);
end
disp('lg(cond(A)):'); disp(log10(cond(A)));
disp('--------------------------------');
disp('Коэффициенты а:'); disp(a');
disp('----------------------------');

F_base = zeros(1,baseSize);
delta_base = zeros(1,baseSize);
for j = 1:baseSize
    S1 = 0; 
    for n = 1:N
        S1 = S1 + a(n).*y0(j).^(-2*n);
    end
    F_base(j) = 1 + S1;
    delta_base(j) = F_base(j)/z(j)-1;
end
%---------------------------------------
% Добавим вспомогательную сетку

F = zeros(1,length(Y));
delta_additional = zeros(1,length(Y));
for j = 1:length(Y)
    S1 = 0;
    for n = 1:baseSize
        S1 = S1 + a(n).*Y(j).^(-2*n);
    end
    F(j) = 1 + S1;
    delta_additional(j) = F(j)/I(j)-1;
end

% disp((I-F)');

disp('lg(dc):');disp(log10(max(abs(delta_additional))));
disp('-------------------');
disp('Экстремумы:');
disp(max(abs(delta_additional(1:11))));
disp(max(abs(delta_additional(11:22))));
disp('-------------------');

figure
grid on, hold on
xlabel('y'); %ylabel('d*10^1^0');
plot(Y,delta_additional, 'k','linewidth', 2.5);
plot(y0,delta_base, 'k*','linewidth',5)
