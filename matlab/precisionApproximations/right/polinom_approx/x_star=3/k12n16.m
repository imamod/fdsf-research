%% В этом файле значения z и I правильно аппроксимируются, т.е 
% z = (Ik/(k!*y))^(1/k)
%
clc 
clear all 
close all
format long

% коэффициент k функции Ферми-Дирака
k = 1/2;

N = 16;

x_star = 3;
y_star = log(1+exp(x_star));

y_star_inv = 1/y_star^2;

% задаем лин-триг сетку
baseSize = N;
j = 1:baseSize;
alpha = 2/(2+pi);
% y0 = 0.5*y_star*(2*alpha*j/(baseSize)+(1-alpha)*(1 - cos(pi*j/(baseSize))));
y0_inv = 0.5*y_star_inv*(2*alpha*j/baseSize +(1-alpha)*(1 - cos(pi*j/baseSize)));
y0 = 1./sqrt(y0_inv(end:-1:1));
x0 = log(exp(y0)-1);

Y = [3.04858735157373983
3.05277833196919524
3.05698664440638446
3.06121240867838784
3.06545574574065549
3.06971677772554763
3.07399562795710057
3.07829242096601741
3.08260728250489002
3.08694033956365743
3.09129172038530564
3.09566155448180513
3.10172915965509866
3.10783258341937074
3.11397217957741157
3.12014830684404698
3.12636132893417118
3.13261161465271254
3.13889953798658627
3.14522547819868592
3.15158981992396603
3.15799295326767293
3.16443527390578261
3.17260989872957744
3.18084820469066587
3.18915102291027797
3.19751919977545018
3.20595359730143192
3.21445509350467962
3.22302458278677362
3.23166297632966382
3.24037120250262767
3.24915020728135406
3.25800095467959228
3.26859037747592085
3.27928373191082390
3.29008272927491596
3.30098912056867855
3.31200469769509187
3.32313129469634250
3.33437078903654394
3.34572510293250014
3.35719620473466307
3.36878611036053277
3.38049688478286292
3.39391681577421522
3.40749785002736072
3.42124323690382370
3.43515631826453616
3.44924053188312785
3.46349941501441716
3.47793660812653904
3.49255585880563713
3.50736102584262710
3.52235608351216767
3.53754512605459315
3.55436399486294574
3.57142505794431520
3.58873418438936787
3.60629744435437027
3.62412111800500414
3.64221170495128632
3.66057593420578486
3.67922077469978337
3.69815344639471277
3.71738143202909521
3.73691248954440347
3.75792025718019973
3.77928635308671268
3.80102108112916648
3.82313516481002402
3.84563976950096054
3.86854652613155636
3.89186755644889137
3.91561549997263869
3.93980354278183142
3.96444544828224599
3.98955559011747329
4.01587429909188742
4.04272084194872328
4.07011310117173508
4.09806981908041301
4.12661065172626174
4.15575622697650626
4.18552820717524110
4.21594935681453897
4.24704361569590549
4.27883617811639994
4.31135357867466151
4.34462378536098370
4.37867630067366775
4.41354227159253654
4.44925460934136119
4.48584811998589039
4.52335964704549109
4.56182822744667238
4.60129526231918629
4.64180470433355730
4.68340326350731040
4.72614063367099124
4.76885436738077040
4.81274754619317324
4.85787546846937435
4.90429713173420545
4.95207555703600022
5.00127814875950527
5.05197709456444866
5.10424981084762219
5.15817943998193051
5.21385540659843905
5.27137404137999965
5.32751355861915599
5.38548578542223932
5.44539265895872049
5.50734423498345116
5.57145953854177201
5.63786752622486897
5.70670817768474326
5.77813373744348091
5.85231013208270578
5.92941859285779849
6.00965751988132002
6.08604052109735072
6.16541206745765891
6.24797226633200875
6.33394050027282418
6.42355788179605192
6.51709010140471268
6.61483074554063499
6.71710517893904235
6.82427510847650876
6.93674397455673208
7.05496335342402059
7.16446230773135984
7.27922337184510759
7.39968197729343835
7.52632572877406592
7.65970272696247534
7.80043157377007734
7.94921347735798101
8.10684699838859935
8.27424614678476367
8.45246276752158465
8.64271447100365364
8.81355057334268821
8.99493488117935414
9.18799957279954960
9.39405460257161629
9.61462528040841313
9.85150003989611989
10.10679182938384990
10.38301796924512921
10.68320542051559841
11.01103160970112427
11.37101593434096003
11.68325433599892982
12.02271262441390931
12.39359039269210072
12.80105417219938779
13.25154389475242667
13.75320709476435965
14.31652895568836925
14.95527195932449338
15.68792265546576381
16.54000436731909573
17.54794357048423592
18.40443848391439019
19.39998155520855505
20.57678776887287242
21.99751141470939331
23.76002791483310261
26.02780651181305416
29.09997233281283613
33.60175371952030332
41.15357553774574484
58.19994466562567226
]';

X = log(exp(Y)-1); 

I_base = [3.97698535404797671
4.05845320517373054
4.17852769721401440
4.34388502104793250
4.56382786245414884
4.85149304676746063
5.22576239485419958
5.71442052600215611
6.35962395754328824
7.22790922576734474
8.42979540713920628
10.16169091389901347
12.80670644827435112
17.22192029011898384
25.80839904035979160
49.20277477026140645
]';

C1 = (k+1)*k*(pi^2)/6;
z = ((I_base*(k+1)./(y0.^(k+1))).^(2/k) - 1).*(y0.^2)*k/(2*C1);

I_add = [3.97698535404797315
3.98421456419401343
3.99147835812644036
3.99877699951626031
4.00611075478726608
4.01347989315251841
4.02088468665143672
4.02832541018745793
4.03580234156633555
4.04331576153503480
4.05086595382128145
4.05845320517372610
4.06899663387841404
4.07961212075663582
4.09030045125431574
4.10106242255302966
4.11189884379293780
4.12281053630078187
4.13379833382319983
4.14486308276545845
4.15600564243576009
4.16722688529526053
4.17852769721401085
4.19288295785386822
4.20736783067080999
4.22198418329239900
4.23673392027277185
4.25161898402175620
4.26664135576244608
4.28180305651824078
4.29710614813035363
4.31255273430702690
4.32814496170548324
4.34388502104792806
4.36274402971440445
4.38181786222266467
4.40111042599767011
4.42062572608944571
4.44036786828098151
4.46034106231664218
4.48054962525657618
4.50099798496288184
4.52169068372374383
4.54263238202187480
4.56382786245414529
4.58816046221220741
4.61283263435102686
4.63785194926382438
4.66322620943016197
4.68896345849443374
4.71507199077736505
4.74156036124503100
4.76843739596139660
4.79571220305208179
4.82339418420900845
4.85149304676746063
4.88267592167225750
4.91438175028058311
4.94662454862809309
4.97941884994841022
5.01277972906126035
5.04672282816535311
5.08126438413178683
5.11642125740157372
5.15221096259886657
5.18865170098076511
5.22576239485419780
5.26578631802058883
5.30660686546104188
5.34824938676946537
5.39074034365888100
5.43410737241718866
5.47837935065535842
5.52358646869839376
5.56976030600240701
5.61693391301818057
5.66514189896227904
5.71442052600215611
5.76623813012279118
5.81927085677585598
5.87356428307746459
5.92916634682882293
5.98612750335416255
6.04450089511896049
6.10434253536764526
6.16571150716014049
6.22867017934457401
6.29328444118217600
6.35962395754328824
6.42776244682311582
6.49777798398778828
6.56975333145938389
6.64377630088915883
6.71994014925789962
6.79834401318907933
6.87909338587405372
6.96230064159994022
7.04808561355344843
7.13657623136417918
7.22790922576734740
7.31961532616326771
7.41429326846287307
7.51209736690355179
7.61319305167794269
7.71775790170957254
7.82598279581487688
7.93807319850036386
8.05425059925673104
8.17475412730975037
8.29984236747222859
8.42979540713920628
8.55733955224027731
8.68977689039822643
8.82740879047847393
8.97056246067528384
9.11959381726186713
9.27489074791319723
9.43687683485759976
9.60601561581480823
9.78281547624265713
9.96783528558058407
10.16169091389901169
10.34747770529757815
10.54181404138658706
10.74533359447136149
10.95873573809579504
11.18279441422519049
11.41836849106277008
11.66641391450268372
11.92799802913317464
12.20431653805930594
12.49671369121151976
12.80670644827435112
13.09623133284033081
13.40212506317164909
13.72588657777657062
14.06920818360296010
14.43400826582301910
14.82247094231371065
15.23709446005689649
15.68075068599010358
16.15675880191062319
16.66897735710049133
17.22192029011898029
17.72377235544151830
18.26207962687679043
18.84117351956410502
19.46611839811111722
20.14287608075161984
20.87851725424944149
21.68149632306126406
22.56201326675522978
23.53249672480981047
24.60825893633188599
25.80839904035979515
26.86509415919627841
28.03024050388552624
29.32239146610669422
30.76471473876160445
32.38654920295311967
34.22564637411671384
36.33147905184669213
38.77026759986257076
41.63287468881983955
45.04770242164381244
49.20277477026140645
52.82939664825997994
57.15251421242600571
62.40815351145265311
68.95677198019608056
77.37999060202155022
88.68625000557992166
104.80464040751390087
129.99489606167816191
176.13128629665015978
296.10844199140876754
]';

I = (((I_add*(k+1)./(Y.^(k+1))).^(2/k) - 1).*(Y.^2))*k/(2*C1);

% Задаем матрицы A и B
B = z(1,:) - ones(1,baseSize);
A = zeros(baseSize,baseSize);
for i = 1:size(A,2)
    for j = 1:size(A,2)
        A(i,j) = y0(i)^(-2*j);
    end
end
disp('A matrix: ')
disp(A); 
disp('B matrix: ')
disp(B');
E = A\B';

a0 = 1;
a = zeros(1,baseSize);
for j = 1:length(E)
    a(j) = E(j);
end
disp('--------------------------------');
disp('Коэффициенты а:'); disp(a');
disp('----------------------------');

F_base = zeros(1,baseSize);
delta_base = zeros(1,baseSize);
for j = 1:baseSize
    F_base(j) = 1; 
    for n = 1:baseSize
        F_base(j) = F_base(j) + a(n).*y0(j).^(-2*n);
    end
    delta_base(j) = F_base(j)/z(j)-1;
end
%---------------------------------------
% Добавим вспомогательную сетку

F = zeros(1,length(Y));
delta_additional = zeros(1,length(Y));
for j = 1:length(Y)
    F(j) = 1;
    for n = 1:baseSize
        F(j) = F(j) + a(n).*Y(j).^(-2*n);
    end
    delta_additional(j) = F(j)/I(j)-1;
end

disp('-------------------');
disp('Экстремумы:');
disp(max(abs(delta_additional(1:11))));
disp(max(abs(delta_additional(11:22))));
disp(max(abs(delta_additional(22:33))));
disp(max(abs(delta_additional(33:44))));
disp(max(abs(delta_additional(44:55))));
disp(max(abs(delta_additional(55:66))));
disp(max(abs(delta_additional(66:77))));
disp(max(abs(delta_additional(77:88))));
disp(max(abs(delta_additional(88:99))));
disp(max(abs(delta_additional(99:110))));
disp(max(abs(delta_additional(110:121))));
disp(max(abs(delta_additional(121:132))));
disp(max(abs(delta_additional(132:143))));
disp(max(abs(delta_additional(143:154))));
disp(max(abs(delta_additional(154:165))));
disp(max(abs(delta_additional(165:176))));
disp('-------------------');

grid on, hold on
xlabel('y'); %ylabel('d*10^1^0');
plot(Y,delta_additional, 'k','linewidth', 2.5);
plot(y0,delta_base, 'k*','linewidth',5)
% axis([0 y_star -1.5*10^(-1) 1.5*10^(-1)])
% line([0;y_star],[0; 0],'linewidth', 2, 'color', 'black');
% line([0;log(1+exp(x_star))],[0; 0],'linewidth', 2, 'color', 'black');
% line([0;0],[-1.25; 1.35],'linewidth', 3, 'color', 'black');
% title({'Линейно-тригонометрическая сетка';['k = ', num2str(k), ', N = ', num2str(N), ', x_d_i_v = ', num2str(x_div)]})
% plot(log(1+exp(x_div)),2*10^-16,'b*');