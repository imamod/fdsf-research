%% В этом файле значения z и I правильно аппроксимируются, т.е 
% z = (Ik/(k!*y))^(1/k)
%
clc 
clear all 
close all
format long

% коэффициент k функции Ферми-Дирака
k = 1/2;

N = 8;

x_star = 3;
y_star = log(1+exp(x_star));

y_star_inv = 1/y_star^2;

% задаем лин-триг сетку
baseSize = N;
j = 1:baseSize;
alpha = 2/(2+pi);
% y0 = 0.5*y_star*(2*alpha*j/(baseSize)+(1-alpha)*(1 - cos(pi*j/(baseSize))));
y0_inv = 0.5*y_star_inv*(2*alpha*j/baseSize +(1-alpha)*(1 - cos(pi*j/baseSize)));
y0 = 1./sqrt(y0_inv(end:-1:1));
x0 = log(exp(y0)-1);

Y = [3.04858735157374072
3.05859678525368084
3.06870546279636436
3.07891503512772235
3.08922719187982286
3.09964366256548640
3.11016621779676905
3.12079667054925292
3.13153687747420406
3.14238874026074244
3.15335420705030556
3.16443527390578394
3.18238585056585599
3.20064541375886558
3.21922293084115863
3.23812773779930474
3.25736955896503488
3.27695852803439314
3.29690521049428842
3.31722062756920266
3.33791628181135636
3.35900418446929638
3.38049688478286381
3.40876070479682847
3.43774551807688011
3.46748250884948650
3.49800478289134054
3.52934752249409378
3.56154815698243077
3.59464655066468852
3.62868521036213787
3.66370951497381636
3.69976796989654000
3.73691248954440436
3.77989118633878984
3.82438774160036354
3.87049365426822289
3.91830833626430453
3.96794001465900070
4.01950676282191477
4.07313768293441214
4.12897426684280955
4.18717196793615809
4.24790202384482285
4.31135357867466151
4.37773616474546934
4.44728261809627412
4.52025252030232938
4.59693628270517340
4.67766001974831447
4.76279139817055519
4.85274670173588074
4.94799942177438457
5.04909077893504499
5.15664271114206851
5.27137404137999965
5.38050981626328273
5.49671741066413144
5.62079511172871449
5.75367334280087483
5.89644418325775277
6.05039937076503342
6.21707982567979123
6.39834106774470879
6.59644092657214287
6.81415911980328914
7.05496335342402325
7.26087812263010068
7.48594394793941920
7.73332619761028450
8.00697471674959083
8.31189290635161626
8.65452894988473354
9.04336063633155440
9.48979824154070251
10.00963243977821548
10.62546428508768770
11.37101593434095825
11.92602212462057842
12.57113111312049902
13.33369808590904171
14.25432283890146756
15.39642835838556678
16.86594223380001978
18.85669666968074765
21.77383779653460039
26.66739617181808342
37.71339333936149529
]';

X = log(exp(Y)-1); 

I_base = [3.97698535404797671
4.17852769721401440
4.56382786245414884
5.22576239485419958
6.35962395754328824
8.42979540713920628
12.80670644827435112
25.80839904035979160
]';

C1 = (k+1)*k*(pi^2)/6;
z = ((I_base*(k+1)./(y0.^(k+1))).^(2/k) - 1).*(y0.^2)*k/(2*C1);

I_add = [3.97698535404797493
3.99425879758963287
4.01173046374619879
4.02940399183768871
4.04728311303858934
4.06537165333305506
4.08367353658587984
4.10219278773462204
4.12093353610853352
4.13990001888024217
4.15909658465639520
4.17852769721401174
4.21007334867951943
4.24224889906151503
4.27507454919207230
4.30857139457777194
4.34276147615651986
4.37766783457925879
4.41331456830722590
4.44972689584326542
4.48693122244657960
4.52495521171464699
4.56382786245414707
4.61512924148842441
4.66795382949580162
4.72237453854530553
4.77846912512568700
4.83632060479455905
4.89601771053596213
4.95765540033169749
5.02133542026263680
5.08716693040447954
5.15526720189453069
5.22576239485419958
5.30776408742723671
5.39315076514289160
5.48214861257910346
5.57500492044507201
5.67199064055317681
5.77340332458198624
5.87957051607279713
5.99085367991871376
6.10765277209126367
6.23041157554709901
6.35962395754328824
6.49584124080134195
6.63968092856127257
6.79183708489841198
6.95309275129817106
7.12433488469187370
7.30657243971625192
7.50095840121615343
7.70881681954654940
7.93167623639321473
8.17131134964386696
8.42979540713920628
8.67838031864537918
8.94594732453264818
9.23487572384788535
9.54797002407648598
9.88856089846639996
10.26063667237933075
10.66901677596967524
11.11958380922477474
11.61959891974505865
12.17813794138755590
12.80670644827435467
13.35305818445022297
13.95941099631550486
14.63678263760115605
15.39914327429914742
16.26449440527375856
17.25646486124933432
18.40674128502148577
19.75889661412197285
21.37466568041545401
23.34473431585306358
25.80839904035979160
27.69664415930726520
29.94794241059066664
32.68535965505093799
36.09684914959850488
40.48569859024975415
46.37778538707684817
54.77912974875417262
67.91128714691275547
91.96728071829392093
154.53573781875007853
]';

I = (((I_add*(k+1)./(Y.^(k+1))).^(2/k) - 1).*(Y.^2))*k/(2*C1);

% Задаем матрицы A и B
B = z(1,:) - ones(1,baseSize);
A = zeros(baseSize,baseSize);
for i = 1:size(A,2)
    for j = 1:size(A,2)
        A(i,j) = y0(i)^(-2*j);
    end
end
disp('A matrix: ')
disp(A); 
disp('B matrix: ')
disp(B');
E = A\B';

a0 = 1;
a = zeros(1,baseSize);
for j = 1:length(E)
    a(j) = E(j);
end
disp('--------------------------------');
disp('Коэффициенты а:'); disp(a');
disp('----------------------------');

F_base = zeros(1,baseSize);
delta_base = zeros(1,baseSize);
for j = 1:baseSize
    F_base(j) = 1; 
    for n = 1:baseSize
        F_base(j) = F_base(j) + a(n).*y0(j).^(-2*n);
    end
    delta_base(j) = F_base(j)/z(j)-1;
end
%---------------------------------------
% Добавим вспомогательную сетку

F = zeros(1,length(Y));
delta_additional = zeros(1,length(Y));
for j = 1:length(Y)
    F(j) = 1;
    for n = 1:baseSize
        F(j) = F(j) + a(n).*Y(j).^(-2*n);
    end
    delta_additional(j) = F(j)/I(j)-1;
end

disp('-------------------');
disp('Экстремумы:');
disp(max(abs(delta_additional(1:11))));
disp(max(abs(delta_additional(11:22))));
disp(max(abs(delta_additional(22:33))));
disp(max(abs(delta_additional(33:44))));
disp(max(abs(delta_additional(44:55))));
disp(max(abs(delta_additional(55:66))));
disp(max(abs(delta_additional(66:77))));
disp(max(abs(delta_additional(77:88))));
disp('-------------------');

grid on, hold on
xlabel('y'); %ylabel('d*10^1^0');
plot(Y,delta_additional, 'k','linewidth', 2.5);
plot(y0,delta_base, 'k*','linewidth',5)
% axis([0 y_star -1.5*10^(-1) 1.5*10^(-1)])
% line([0;y_star],[0; 0],'linewidth', 2, 'color', 'black');
% line([0;log(1+exp(x_star))],[0; 0],'linewidth', 2, 'color', 'black');
% line([0;0],[-1.25; 1.35],'linewidth', 3, 'color', 'black');
% title({'Линейно-тригонометрическая сетка';['k = ', num2str(k), ', N = ', num2str(N), ', x_d_i_v = ', num2str(x_div)]})
% plot(log(1+exp(x_div)),2*10^-16,'b*');