%% В этом файле значения z и I правильно аппроксимируются, т.е 
% z = (Ik/(k!*y))^(1/k)
%
clc 
clear all 
close all
format long

% коэффициент k функции Ферми-Дирака
k = 1/2;

N = 5;

x_star = 10;
y_star = log(1+exp(x_star));

y_star_inv = 1/y_star^2;

% задаем лин-триг сетку
baseSize = N;
j = 1:baseSize;
alpha = 2/(2+pi);
% y0 = 0.5*y_star*(2*alpha*j/(baseSize)+(1-alpha)*(1 - cos(pi*j/(baseSize))));
y0_inv = 0.5*y_star_inv*(2*alpha*j/baseSize +(1-alpha)*(1 - cos(pi*j/baseSize)));
y0 = 1./sqrt(y0_inv(end:-1:1));
x0 = log(exp(y0)-1);

Y = [10.00004539889921595
10.06250960320887344
10.12615915129980593
10.19103201298255001
10.25716788296887572
10.32460828294492217
10.39339667112536070
10.46357855994531505
10.53520164261420788
10.60831592933109491
10.68297389404547815
10.75923063274216673
10.89217673749507398
11.03017608807911287
11.17355713731009281
11.32267902520134228
11.47793536644244483
11.63975862534783801
11.80862518909331094
11.98506127490071727
12.16964983817943313
12.36303868845265796
12.56595007082979976
12.81353682964259377
13.07635960067415404
13.35604801738830005
13.65448666770536157
13.97386878226483731
14.31676442053909071
14.68620802100618761
15.08581216908021183
15.51991739708195794
15.99379232933362971
16.51390547402394304
17.00709381568140799
17.54728427941559943
18.14245061243979151
18.80259868133303769
19.54048480324102144
20.37267098425303757
21.32112129092938702
22.41570118358712804
23.69825297353844462
25.22957508064256515
27.10211667818868619
28.42493977622413226
29.96251734866171290
31.78004879798741200
33.97430123915025746
36.69643945675494479
40.19893534117461797
44.94377602299256580
51.89660237054601311
63.56009759597482400
89.88755204598513160
]';

X = log(exp(Y)-1); 

I_base = [21.34447149235519703
23.78050192280538866
29.92962375857960211
44.94176410089801266
94.22003233687448187
]';

C1 = (k+1)*k*(pi^2)/6;
z = ((I_base*(k+1)./(y0.^(k+1))).^(2/k) - 1).*(y0.^2)*k/(2*C1);

I_add = [21.34447149235518282
21.54146547556972990
21.74283860839411631
21.94874554944942702
22.15934849915850435
22.37481767167646751
22.59533180304527633
22.82107869888027452
23.05225582524855454
23.28907094679328083
23.53174281660058753
23.78050192280537800
24.21633113572131180
24.67159002362044262
25.14767304668000136
25.64611474605145247
26.16860805744235918
26.71702560492355616
27.29344456085998161
27.90017579408160486
28.53979820148833824
29.21519933969255334
29.92962375857959501
30.80927154429426551
31.75249350725513153
32.76681182953328886
33.86101669430960470
35.04544976314204519
36.33236815981437218
37.73641719600079369
39.27525206737632857
40.97036682781105554
42.84821676683274205
44.94176410089802687
46.95783404543574591
49.20001675164938604
51.71086581629304391
54.54465736224594963
57.77180510814335435
61.48546199097069831
65.81169959434329542
70.92577901323787160
77.07929054843430094
84.64780871685330510
94.22003233687448187
101.18622767860455269
109.48967589594428773
119.58348711195336023
132.15963472425710279
148.33464006386219580
170.04434016980795263
200.99180940635315551
249.35385424556884004
337.92335400253580246
568.23029628454935391
]';

I = (((I_add*(k+1)./(Y.^(k+1))).^(2/k) - 1).*(Y.^2))*k/(2*C1);

% Задаем матрицы A и B
B = z(1,:) - ones(1,baseSize);
A = zeros(baseSize,baseSize);
for i = 1:size(A,2)
    for j = 1:size(A,2)
        A(i,j) = y0(i)^(-2*j);
    end
end
disp('A matrix: ')
disp(A); 
disp('B matrix: ')
disp(B');
E = A\B';

a0 = 1;
a = zeros(1,baseSize);
for j = 1:length(E)
    a(j) = E(j);
end
disp('--------------------------------');
disp('Коэффициенты а:'); disp(a');
disp('----------------------------');

F_base = zeros(1,baseSize);
delta_base = zeros(1,baseSize);
for j = 1:baseSize
    F_base(j) = 1; 
    for n = 1:baseSize
        F_base(j) = F_base(j) + a(n).*y0(j).^(-2*n);
    end
    delta_base(j) = F_base(j)/z(j)-1;
end
%---------------------------------------
% Добавим вспомогательную сетку

F = zeros(1,length(Y));
delta_additional = zeros(1,length(Y));
for j = 1:length(Y)
    F(j) = 1;
    for n = 1:baseSize
        F(j) = F(j) + a(n).*Y(j).^(-2*n);
    end
    delta_additional(j) = F(j)/I(j)-1;
end

disp('-------------------');
disp('Экстремумы:');
disp(max(abs(delta_additional(1:11))));
disp(max(abs(delta_additional(11:22))));
disp(max(abs(delta_additional(22:33))));
disp(max(abs(delta_additional(33:44))));
disp(max(abs(delta_additional(44:55))));
disp('-------------------');

grid on, hold on
xlabel('y'); %ylabel('d*10^1^0');
plot(Y,delta_additional, 'k','linewidth', 2.5);
plot(y0,delta_base, 'k*','linewidth',5)
% axis([0 y_star -1.5*10^(-1) 1.5*10^(-1)])
% line([0;y_star],[0; 0],'linewidth', 2, 'color', 'black');
% line([0;log(1+exp(x_star))],[0; 0],'linewidth', 2, 'color', 'black');
% line([0;0],[-1.25; 1.35],'linewidth', 3, 'color', 'black');
% title({'Линейно-тригонометрическая сетка';['k = ', num2str(k), ', N = ', num2str(N), ', x_d_i_v = ', num2str(x_div)]})
% plot(log(1+exp(x_div)),2*10^-16,'b*');