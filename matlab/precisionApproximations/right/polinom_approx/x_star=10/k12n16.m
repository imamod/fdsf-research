%% В этом файле значения z и I правильно аппроксимируются, т.е 
% z = (Ik/(k!*y))^(1/k)
%
clc 
clear all 
close all
format long

% коэффициент k функции Ферми-Дирака
k = 1/2;

N = 16;

x_star = 10;
y_star = log(1+exp(x_star));

y_star_inv = 1/y_star^2;

% задаем лин-триг сетку
baseSize = N;
j = 1:baseSize;
alpha = 2/(2+pi);
% y0 = 0.5*y_star*(2*alpha*j/(baseSize)+(1-alpha)*(1 - cos(pi*j/(baseSize))));
y0_inv = 0.5*y_star_inv*(2*alpha*j/baseSize +(1-alpha)*(1 - cos(pi*j/baseSize)));
y0 = 1./sqrt(y0_inv(end:-1:1));
x0 = log(exp(y0)-1);

Y = [10.00004539889921240
10.01379274787998241
10.02759694981729233
10.04145839765911496
10.05537748816626653
10.06935462196008402
10.08339020357086824
10.09748464148705871
10.11163834820516172
10.12585174028045643
10.14012523837849145
10.15445926732737192
10.17436236348245160
10.19438295259233485
10.21452219520895888
10.23478126799683530
10.25516136402181289
10.27566369304618554
10.29628948183031945
10.31703997444095755
10.33791643256640924
10.35892013583875304
10.38005238216330284
10.40686697198134247
10.43389045011076988
10.46112554281430462
10.48857502642989914
10.51624172855954242
10.54412852929272759
10.57223836246581428
10.60057421695850799
10.62913913802877452
10.65793622868753587
10.68696865111455985
10.72170431603056073
10.75678089986547903
10.79220401603361701
10.82797940820648286
10.86411295422488266
10.90061067015561669
10.93747871449906128
10.97472339255439167
11.01235116094941802
11.05036863234246169
11.08878258030400410
11.13280294242167301
11.17735175911388801
11.22243968901004330
11.26807769415819216
11.31427705122139216
11.36104936318315417
11.40840657158965676
11.45636096935798420
11.50492521418165914
11.55411234256658304
11.60393578453279950
11.65910541959502922
11.71506950580666562
11.77184729509207273
11.82945869891556079
11.88792431761908652
11.94726547137089590
12.00750423283068358
12.06866346164496484
12.13076684089503487
12.19383891562956634
12.25790513362419532
12.32681528966057627
12.39690084222054267
12.46819559027657576
12.54073470930476297
12.61455482421059493
12.68969408703317470
12.76619225980229899
12.84409080295717231
12.92343296977341183
13.00426390728691928
13.08663076424952010
13.17296199056281658
13.26102462955305406
13.35087733974918045
13.44258160013282577
13.53620188693009752
13.63180586413908912
13.72946458907238920
13.82925273433338731
13.93124882780214691
14.03553551238350039
14.14219982746994475
14.25133351429778905
14.36303334763133854
14.47740149650048558
14.59454591704815662
14.71458078092092769
14.83762694306694385
14.96381245329824061
15.09327311653996873
15.22615310733920424
15.36260564495522019
15.50279373621845558
15.64290429464932686
15.78688369566581429
15.93491333020688927
16.08718672329207777
16.24391059799398462
16.40530605570477007
16.57160988802371193
16.74307603797204180
16.91997723104773854
17.10260679995455391
17.29128073078399197
17.47543084896054211
17.66559266263035610
17.86210054840954342
18.06531551368217947
18.27562798710251357
18.49346097500679775
18.71927364182546683
18.95356538349409803
19.19688047615037618
19.44981339867008074
19.71301494760387030
19.96356820121826203
20.22392454842090714
20.49474038594625824
20.77673533742028056
21.07070030558827867
21.37750681446642886
21.69811789296228000
22.03360080986239922
22.38514204426995491
22.75406497055066524
23.14185085934675712
23.50103181364682570
23.87747365992393611
24.27260471055614843
24.68802441753598131
25.12553067313481492
25.58715262937768387
26.07519040518412368
26.59226345735721253
27.14136994198346287
27.72596014481515425
28.35002809912733568
28.91040855805676202
29.50538947998383676
30.13868466180953831
30.81459104557396955
31.53811198746048206
32.31511394789556135
33.15252786799388218
34.05861111915922379
35.04329280765829679
36.11863571135140205
37.29946446058573173
38.32367594996542692
39.43717472946736535
40.65373639968153441
41.99030833401581475
43.46801494292841994
45.11358195365772872
46.96140310286131836
49.05662239559148929
51.45987983191383108
54.25489759570086079
57.56116263868166527
60.37065668641047722
63.63625965637688608
67.49644609855802457
72.15673603590252583
77.93818264869108248
85.37700145529167628
95.45438948456533979
110.22123492849034676
134.99289219711604915
190.90877896913067957
]';

X = log(exp(Y)-1); 

I_base = [21.34447149235519703
21.83258114878419320
22.55249601052710062
23.54475190994515899
24.86581037374407899
26.59528734264698002
28.84735730197144932
31.78955086741039437
35.67524537583092581
40.90304371523019711
48.13302213774773008
58.53532348213563807
74.38867446557846108
100.78730378996922923
152.00148078889529302
291.24923843757619579
]';

C1 = (k+1)*k*(pi^2)/6;
z = ((I_base*(k+1)./(y0.^(k+1))).^(2/k) - 1).*(y0.^2)*k/(2*C1);

I_add = [21.34447149235517571
21.38777306494503350
21.43128415874344839
21.47500636838350019
21.51894130508652836
21.56309059688118879
21.60745588882621604
21.65203884323669570
21.69684113991387164
21.74186447637885422
21.78711056811001612
21.83258114878418610
21.89577213682827761
21.95939960839543303
22.02346831161698049
22.08798306530661648
22.15294876029829041
22.21837036081516459
22.28425290586977425
22.35060151069692225
22.41742136821989462
22.48471775055099542
22.55249601052710062
22.63860045477488114
22.72548979614560594
22.81317531751814087
22.90166852401437581
22.99098114857299890
23.08112515769333228
23.17211275735528631
23.26395639912215785
23.35666878643238320
23.45026288108782708
23.54475190994515899
23.65797408504317545
23.77249662798866581
23.88834312449429831
24.00553774728355449
24.12410527471850941
24.24407111014769001
24.36546130200755300
24.48830256471144295
24.61262230036349052
24.73844862133492839
24.86581037374407899
25.01203559687528610
25.16031503050874818
25.31069432059758739
25.46322050702414330
25.61794207795707123
25.77490902679569729
25.93417291184684359
26.09578691889006308
26.25980592679623982
26.42628657637607148
26.59528734264700489
26.78285162607549097
26.97357667635382228
27.16754689030812031
27.36484976698590899
27.56557605351274631
27.76981989933302231
27.97767901940632740
28.18925486697596838
28.40465281657550634
28.62398235799305013
28.84735730197146353
29.08828128192407547
29.33401436986632760
29.58470896499450120
29.84052412732568627
30.10162595077254366
30.36818796181430002
30.64039154585001867
30.91842640351854143
31.20249103948799885
31.49279328646075982
31.78955086741039437
32.10160573111367910
32.42098482753647914
32.74796166913596096
33.08282388528715501
33.42587415802530870
33.77743123393254621
34.13783101954629018
34.50742776850057680
34.88659536955090346
35.27572874569801087
35.67524537583095423
36.08558695167826613
36.50722118441455422
36.94064377704148683
37.38638058069128078
37.84498995531590282
38.31706535788545409
38.80323818427441296
39.30418089452965091
39.82061045527957788
40.35329213774038948
40.90304371523019711
41.45499826209805860
42.02479280837791009
42.61334980859403743
43.22165799658181840
43.85077853521362101
44.50185187060257164
45.17610538744435900
45.87486197770171970
46.59954965326242160
47.35171235511515420
48.13302213774775140
48.89974407128964629
49.69577052084794389
50.52289974890482682
51.38308391314878065
52.27844613796258244
53.21129993311174644
54.18417134776377253
55.19982432350538915
56.26128980259376533
57.37189926165766707
58.53532348213562386
59.65011125259645297
60.81598184374865923
62.03671078182227205
63.31646459426251994
64.65985355649988264
66.07199330417580541
67.55857711271873711
69.12596107972164816
70.78126500067236293
72.53249244447982846
74.38867446557840424
76.12191453528772911
77.95275930605940573
79.89013041114880309
81.94409969817490946
84.12608375152720441
86.44907970870131919
88.92795305584532173
91.57979138899962379
94.42434262807799428
97.48456237711991434
100.78730378996918660
103.78421899366233561
106.99818164714704949
110.45495515211092652
114.18466114957114144
118.22275752409105110
122.61129526454415384
127.40055239400003018
132.65118508478968806
138.43709934124925098
144.84934414970115313
152.00148078889523617
158.29760587338816435
165.23878130425669042
172.93530957410692395
181.52492056004101073
191.18202453443390709
202.13103336892453399
214.66602377993473283
229.18060768001245719
246.21484817306568971
266.53190126356048495
291.24923843757619579
312.82007034010183588
338.53067292398850441
369.78365757028785765
408.72101828302578497
458.79889341362627420
526.00950791119032601
621.81529789455828450
771.52633243783930084
1045.69371126797136640
1758.58065644103749037
]';

I = (((I_add*(k+1)./(Y.^(k+1))).^(2/k) - 1).*(Y.^2))*k/(2*C1);

% Задаем матрицы A и B
B = z(1,:) - ones(1,baseSize);
A = zeros(baseSize,baseSize);
for i = 1:size(A,2)
    for j = 1:size(A,2)
        A(i,j) = y0(i)^(-2*j);
    end
end
disp('A matrix: ')
disp(A); 
disp('B matrix: ')
disp(B');
E = A\B';

a0 = 1;
a = zeros(1,baseSize);
for j = 1:length(E)
    a(j) = E(j);
end
disp('--------------------------------');
disp('Коэффициенты а:'); disp(a');
disp('----------------------------');

F_base = zeros(1,baseSize);
delta_base = zeros(1,baseSize);
for j = 1:baseSize
    F_base(j) = 1; 
    for n = 1:baseSize
        F_base(j) = F_base(j) + a(n).*y0(j).^(-2*n);
    end
    delta_base(j) = F_base(j)/z(j)-1;
end
%---------------------------------------
% Добавим вспомогательную сетку

F = zeros(1,length(Y));
delta_additional = zeros(1,length(Y));
for j = 1:length(Y)
    F(j) = 1;
    for n = 1:baseSize
        F(j) = F(j) + a(n).*Y(j).^(-2*n);
    end
    delta_additional(j) = F(j)/I(j)-1;
end

disp('-------------------');
disp('Экстремумы:');
disp(max(abs(delta_additional(1:11))));
disp(max(abs(delta_additional(11:22))));
disp(max(abs(delta_additional(22:33))));
disp(max(abs(delta_additional(33:44))));
disp(max(abs(delta_additional(44:55))));
disp(max(abs(delta_additional(55:66))));
disp(max(abs(delta_additional(66:77))));
disp(max(abs(delta_additional(77:88))));
disp(max(abs(delta_additional(88:99))));
disp(max(abs(delta_additional(99:110))));
disp(max(abs(delta_additional(110:121))));
disp(max(abs(delta_additional(121:132))));
disp(max(abs(delta_additional(132:143))));
disp(max(abs(delta_additional(143:154))));
disp(max(abs(delta_additional(154:165))));
disp(max(abs(delta_additional(165:176))));
disp('-------------------');

grid on, hold on
xlabel('y'); %ylabel('d*10^1^0');
plot(Y,delta_additional, 'k','linewidth', 2.5);
plot(y0,delta_base, 'k*','linewidth',5)
% axis([0 y_star -1.5*10^(-1) 1.5*10^(-1)])
% line([0;y_star],[0; 0],'linewidth', 2, 'color', 'black');
% line([0;log(1+exp(x_star))],[0; 0],'linewidth', 2, 'color', 'black');
% line([0;0],[-1.25; 1.35],'linewidth', 3, 'color', 'black');
% title({'Линейно-тригонометрическая сетка';['k = ', num2str(k), ', N = ', num2str(N), ', x_d_i_v = ', num2str(x_div)]})
% plot(log(1+exp(x_div)),2*10^-16,'b*');