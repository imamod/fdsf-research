%% В этом файле значения z и I правильно аппроксимируются, т.е 
% z = (Ik/(k!*y))^(1/k)
%
clc 
clear all 
close all
format long

% коэффициент k функции Ферми-Дирака
k = 1/2;

N = 8;

x_star = 10;
y_star = log(1+exp(x_star));

y_star_inv = 1/y_star^2;

% задаем лин-триг сетку
baseSize = N;
j = 1:baseSize;
alpha = 2/(2+pi);
% y0 = 0.5*y_star*(2*alpha*j/(baseSize)+(1-alpha)*(1 - cos(pi*j/(baseSize))));
y0_inv = 0.5*y_star_inv*(2*alpha*j/baseSize +(1-alpha)*(1 - cos(pi*j/baseSize)));
y0 = 1./sqrt(y0_inv(end:-1:1));
x0 = log(exp(y0)-1);

Y = [10.00004539889922306
10.03287857035648756
10.06603728378403240
10.09952695458655114
10.13335312513348718
10.16752146861203876
10.20203779302404179
10.23690804533313603
10.27213831576892922
10.30773484229522019
10.34370401524975058
10.38005238216330461
10.43893427099764537
10.49882970446780739
10.55976809749953738
10.62178007420779480
10.68489753256616304
10.74915371335432290
10.81458327372214612
10.88122236574023916
10.94910872034136951
11.01828173709554193
11.08878258030400588
11.18149420398113669
11.27657084612803473
11.37411479795188463
11.47423465377252327
11.57704581934126153
11.68267107117814874
11.79124117309186381
11.90289555692195300
12.01778307556262959
12.13606283751705028
12.25790513362419532
12.39888482997683994
12.54484344011168240
12.69608110092473297
12.85292390565785503
13.01572686320286998
13.18487728050567043
13.36079864147072804
13.54395507086258199
13.73485649041502832
13.93406459768832839
14.14219982746994475
14.35994949242926744
14.58807734662424593
14.82743487542757777
15.07897469271081370
15.34376652647063466
15.62301640548551873
15.91808983320299831
16.23053996662691389
16.56214213000960100
16.91493641824095207
17.29128073078398842
17.64927037569722401
18.03045716344186999
18.43745965362682782
18.87332984201459851
19.34164999215586533
19.84665729124936107
20.39340630121173348
20.98798354000212996
21.63779519154205389
22.35195934870615275
23.14185085934677133
23.81729715722032736
24.55556318383494130
25.36703205196937105
26.26466013315981485
27.26485969686801525
28.38878222080738922
29.66423674074808048
31.12865150241226075
32.83382343379615520
34.85388902516047693
37.29946446058573883
39.12000835827042522
41.23610949898628064
43.73749898472631514
46.75735318720541756
50.50371362502544059
55.32404638041487743
61.85416424847942807
71.42303675871784208
87.47499796945263029
123.70832849695885614
]';

X = log(exp(Y)-1); 

I_base = [21.34447149235519703
22.55249601052710062
24.86581037374407899
28.84735730197144932
35.67524537583092581
48.13302213774773008
74.38867446557846108
152.00148078889529302
]';

C1 = (k+1)*k*(pi^2)/6;
z = ((I_base*(k+1)./(y0.^(k+1))).^(2/k) - 1).*(y0.^2)*k/(2*C1);

I_add = [21.34447149235520769
21.44793998676675173
21.55260936404321725
21.65850163239598558
21.76563935348256251
21.87404566015273488
21.98374427488823812
22.09475952896794126
22.20711638239217578
22.32084044460202676
22.43595799603077978
22.55249601052710062
22.74172000979814001
22.93475835494485793
23.13173306893559911
23.33277155830651139
23.53800691757232499
23.74757825472347150
23.96163103954580720
24.18031747666385911
24.40379690539356616
24.63223622869526253
24.86581037374408254
25.17411829010697844
25.49163997886032362
25.81881498083569326
26.15611192525732065
26.50403101173498044
26.86310675329950826
27.23391101331081288
27.61705637389792045
28.01319987923994503
28.42304720361957138
28.84735730197146353
29.34098085247671150
29.85503634417352004
30.39088323623107257
30.95000736121093965
31.53403618249940266
32.14475633971341040
32.78413389562972924
33.45433778637265476
34.15776708661030625
34.89708283955464907
35.67524537583095423
36.49555826669691783
37.36172034031743294
38.27788755469881465
39.24874699459277139
40.27960587962588335
41.37649928924250275
42.54632140019310071
43.79698649883188466
45.13762802416239595
46.57884663858104801
48.13302213774773008
49.62727484497114006
51.23518545525967482
52.97094823163641308
54.85128951347495985
56.89606843682184234
59.12905925171578048
61.57898325976360354
64.28088937132594083
67.27803017904510341
70.62445624990536430
74.38867446557848950
77.65910884830138627
81.28727171435730270
85.33873427074341578
89.89662850341899514
95.06806306792373107
100.99361357373278736
107.86177420209725142
115.93172058991338247
125.57062027340313648
137.31777337618157731
152.00148078889529302
163.25154877950745913
176.66088702069194483
192.96110540455538285
213.26948471116145356
239.38878143713409941
274.44461388107356470
324.41595594028967753
402.50496730897117459
545.51246095649446488
917.36498651366832746
]';

I = (((I_add*(k+1)./(Y.^(k+1))).^(2/k) - 1).*(Y.^2))*k/(2*C1);

% Задаем матрицы A и B
B = z(1,:) - ones(1,baseSize);
A = zeros(baseSize,baseSize);
for i = 1:size(A,2)
    for j = 1:size(A,2)
        A(i,j) = y0(i)^(-2*j);
    end
end
disp('A matrix: ')
disp(A); 
disp('B matrix: ')
disp(B');
E = A\B';

a0 = 1;
a = zeros(1,baseSize);
for j = 1:length(E)
    a(j) = E(j);
end
disp('--------------------------------');
disp('Коэффициенты а:'); disp(a');
disp('----------------------------');

F_base = zeros(1,baseSize);
delta_base = zeros(1,baseSize);
for j = 1:baseSize
    F_base(j) = 1; 
    for n = 1:baseSize
        F_base(j) = F_base(j) + a(n).*y0(j).^(-2*n);
    end
    delta_base(j) = F_base(j)/z(j)-1;
end
%---------------------------------------
% Добавим вспомогательную сетку

F = zeros(1,length(Y));
delta_additional = zeros(1,length(Y));
for j = 1:length(Y)
    F(j) = 1;
    for n = 1:baseSize
        F(j) = F(j) + a(n).*Y(j).^(-2*n);
    end
    delta_additional(j) = F(j)/I(j)-1;
end

disp('-------------------');
disp('Экстремумы:');
disp(max(abs(delta_additional(1:11))));
disp(max(abs(delta_additional(11:22))));
disp(max(abs(delta_additional(22:33))));
disp(max(abs(delta_additional(33:44))));
disp(max(abs(delta_additional(44:55))));
disp(max(abs(delta_additional(55:66))));
disp(max(abs(delta_additional(66:77))));
disp(max(abs(delta_additional(77:88))));
disp('-------------------');

grid on, hold on
xlabel('y'); %ylabel('d*10^1^0');
plot(Y,delta_additional, 'k','linewidth', 2.5);
plot(y0,delta_base, 'k*','linewidth',5)
% axis([0 y_star -1.5*10^(-1) 1.5*10^(-1)])
% line([0;y_star],[0; 0],'linewidth', 2, 'color', 'black');
% line([0;log(1+exp(x_star))],[0; 0],'linewidth', 2, 'color', 'black');
% line([0;0],[-1.25; 1.35],'linewidth', 3, 'color', 'black');
% title({'Линейно-тригонометрическая сетка';['k = ', num2str(k), ', N = ', num2str(N), ', x_d_i_v = ', num2str(x_div)]})
% plot(log(1+exp(x_div)),2*10^-16,'b*');