%% В этом файле значения z и I правильно аппроксимируются, т.е 
% z = (Ik/(k!*y))^(1/k)
%
clc 
clear all 
close all
format long

% коэффициент k функции Ферми-Дирака
k = 1/2;

N = 4;

x_star = 10;
y_star = log(1+exp(x_star));

y_star_inv = 1/y_star^2;

% задаем лин-триг сетку
baseSize = N;
j = 1:baseSize;
alpha = 2/(2+pi);
% y0 = 0.5*y_star*(2*alpha*j/(baseSize)+(1-alpha)*(1 - cos(pi*j/(baseSize))));
y0_inv = 0.5*y_star_inv*(2*alpha*j/baseSize +(1-alpha)*(1 - cos(pi*j/baseSize)));
y0 = 1./sqrt(y0_inv(end:-1:1));
x0 = log(exp(y0)-1);

Y = [10.00004539889921951
10.08601793171451355
10.17424665964553654
10.26483202426726393
10.35788084079615601
10.45350682770304651
10.55183119112602697
10.65298327091308472
10.75710125612571311
10.86433297900575923
10.97483679778135901
11.08878258030400232
11.28818984389555702
11.49875679341865542
11.72156474381576530
11.95784761794690709
12.20902080373424603
12.47671697369786337
12.76283094339248336
13.06957639428255114
13.39955835733627865
13.75586690875237927
14.14219982746994120
14.56302542600993277
15.02380209209493422
15.53127946619030020
16.09391974004208592
16.72250013791165912
17.43099650740137108
18.23791745824733468
19.16838842800230580
20.25754086023559353
21.55629724419437210
23.14185085934676778
24.27137794431691376
25.58427875160563403
27.13622549554086305
29.00984530701538233
31.33421418928180557
34.32491186633619407
38.37641812740844927
44.31327067278580500
54.27245099108172610
76.75283625481689853
]';

X = log(exp(Y)-1); 

I_base = [21.34447149235519703
24.86581037374407899
35.67524537583092581
74.38867446557846108
]';

C1 = (k+1)*k*(pi^2)/6;
z = ((I_base*(k+1)./(y0.^(k+1))).^(2/k) - 1).*(y0.^2)*k/(2*C1);

I_add = [21.34447149235520413
21.61576540936292190
21.89540460313819636
22.18379893237761635
22.48138619136116745
22.78863456616657146
23.10604535722906050
23.43415600280323474
23.77354344313007672
24.12482787127973793
24.48867692390670570
24.86581037374407188
25.53053661899677351
26.23895345564690018
26.99574232353628034
27.80629620240910427
28.67686237847648911
29.61472141591118756
30.62841360885515485
31.72802841654712580
32.92557849132987968
34.23548887835486454
35.67524537583092581
37.26626649301574190
39.03509530910754677
41.01505840838892425
43.24862250249642415
45.79082041167236383
48.71436491862564822
52.11751832295868780
56.13664155509113840
60.96706714355997292
66.89962503421352835
74.38867446557846108
79.88409080009687102
86.43455216057084556
94.39755773359679836
104.31907019402392223
117.08002247834984644
134.20779388029484380
158.62413293904293710
196.78062505874021326
266.66118830174195864
448.37495361203178845
]';

I = (((I_add*(k+1)./(Y.^(k+1))).^(2/k) - 1).*(Y.^2))*k/(2*C1);

% Задаем матрицы A и B
B = z(1,:) - ones(1,baseSize);
A = zeros(baseSize,baseSize);
for i = 1:size(A,2)
    for j = 1:size(A,2)
        A(i,j) = y0(i)^(-2*j);
    end
end
disp('A matrix: ')
disp(A); 
disp('B matrix: ')
disp(B');
E = A\B';

a0 = 1;
a = zeros(1,baseSize);
for j = 1:length(E)
    a(j) = E(j);
end
disp('--------------------------------');
disp('Коэффициенты а:'); disp(a');
disp('----------------------------');

F_base = zeros(1,baseSize);
delta_base = zeros(1,baseSize);
for j = 1:baseSize
    F_base(j) = 1; 
    for n = 1:baseSize
        F_base(j) = F_base(j) + a(n).*y0(j).^(-2*n);
    end
    delta_base(j) = F_base(j)/z(j)-1;
end
%---------------------------------------
% Добавим вспомогательную сетку

F = zeros(1,length(Y));
delta_additional = zeros(1,length(Y));
for j = 1:length(Y)
    F(j) = 1;
    for n = 1:baseSize
        F(j) = F(j) + a(n).*Y(j).^(-2*n);
    end
    delta_additional(j) = F(j)/I(j)-1;
end

disp('-------------------');
disp('Экстремумы:');
disp(max(abs(delta_additional(1:11))));
disp(max(abs(delta_additional(11:22))));
disp(max(abs(delta_additional(22:33))));
disp(max(abs(delta_additional(33:44))));
disp('-------------------');

grid on, hold on
xlabel('y'); %ylabel('d*10^1^0');
plot(Y,delta_additional, 'k','linewidth', 2.5);
plot(y0,delta_base, 'k*','linewidth',5)
% axis([0 y_star -1.5*10^(-1) 1.5*10^(-1)])
% line([0;y_star],[0; 0],'linewidth', 2, 'color', 'black');
% line([0;log(1+exp(x_star))],[0; 0],'linewidth', 2, 'color', 'black');
% line([0;0],[-1.25; 1.35],'linewidth', 3, 'color', 'black');
% title({'Линейно-тригонометрическая сетка';['k = ', num2str(k), ', N = ', num2str(N), ', x_d_i_v = ', num2str(x_div)]})
% plot(log(1+exp(x_div)),2*10^-16,'b*');