%% Проверка глобальной аппроксимации из статьи
clc
clear all
close all

format shortE

k = 1; N = 4;
n = 0:N+1; m = 0:N;

a = [1 ...
     0.3126028287472988...
     0.0673008212829461...
     0.0087798043423074...
     0.0007222414330882...
     0.0000295873218273];
b = [1 ...
     0.0626028287472659...
     0.0238723363198067...
     0.0010727527758408...
     0.0000687107172921];

x = 0:0.1:50;
y = log(1 + exp(x));

x_minus = 0:-0.1:-50;
y_minus = log(1 + exp(x_minus));

I_approximate_minus = [0.00004539941448448
0.00005017405269553
0.00005545083073115
0.00006128255616210
0.00006772758972994
0.00007485042923519
0.00008272235480177
0.00009142214196555
0.00010103684971152
0.00011166269133162
0.00012340599680056
0.00013638427627907
0.00015072739536099
0.00016657887379313
0.00018409732062505
0.00020345802010218
0.00022485468411370
0.00024850138865977
0.00027463471362795
0.00030351610718368
0.00033543449830263
0.00037070918342682
0.00040969301593282
0.00045277593008681
0.00050038883445392
0.00055300791336072
0.00061115937901216
0.00067542472127540
0.00074644650700269
0.00082493478611778
0.00091167416758221
0.00100753163484283
0.00111346517749343
0.00123053332372528
0.00135990566675670
0.00150287448789211
0.00166086758924190
0.00183546246051582
0.00202840191677004
0.00224161135763206
0.00247721781344224
0.00273757096003385
0.00302526630162661
0.00334317074063314
0.00369445077417573
0.00408260357988149
0.00451149127816027
0.00498537868475613
0.00550897489596788
0.00608747907960718
0.00672663087752228
0.00743276586034642
0.00821287651196303
0.00907467925988711
0.01002668810813160
0.01107829547084987
0.01223986084768446
0.01352280802472172
0.01493973152747778
0.01650451309342871
0.01823244896998264
0.02014038887789720
0.02224688750802442
0.02457236943854358
0.02713930836765693
0.02997242154966134
0.03309888029634504
0.03654853735610415
0.04035417190463771
0.04455175276744724
0.04918072033882324
0.05428428745708681
0.05990975923360558
0.06610887150525324
0.07293814717830098
0.08045926924846318
0.08873946871031871
0.09785192490482633
0.10787617509424731
0.11889852920161248
0.13101248471442128
0.14431913574384037
0.15892756917385165
0.17495523976178862
0.19252831500534245
0.21178197962544190
0.23286068869423127
0.25591835783689981
0.28111847863603545
0.30863414745022544
0.33864799640344639
0.37135201637533033
0.40694726347119375
0.44564344269194250
0.48765836533710682
0.53321727999487234
0.58255208068978137
0.63590039971519430
0.69350459667868747
0.75561065911314940
0.82246703342410021];

I_approximate = [0.82246703342411331
0.89432340773506513
0.97142947016952763
1.05403366713302170
1.14238198615843590
1.23671678685334530
1.33727570151111140
1.44429062415627650
1.55798680337702570
1.67858205047288940
1.80628607044477450
1.94129991939799500
2.08381558821218600
2.23401570901132240
2.39207337815399110
2.55815208722278080
2.73240575184288080
2.91497882708643540
3.10600649767437310
3.30561493110438360
3.51392158213380370
3.73103553764661240
3.95705789175397850
4.19208214194340020
4.43619459813790760
4.68947479759976280
4.95199591966992610
5.22382519534297350
5.50502430761462150
5.79564977939114190
6.09575334650940450
6.40538231408078220
6.72457989494359330
7.05338552949212790
7.39183518655188810
7.73996164529857020
8.09779475848057300
8.46536169740968880
8.84268717934021350
9.22979367797033850
9.62670161787825050
10.03342955375480200
10.44999433532075300
10.87641125882350400
11.31269420600054200
11.75885577137738000
12.21490737874009200
12.68085938758833100
13.15672119033625800
13.64250130098786900
14.13820743597069600
14.64384658776860900
15.15942509195224400
15.68494868816345000
16.22042257557005500
16.76585146326833700
17.32123961607403100
17.88659089610756000
18.46190880054657400
19.04719649588817600
19.64245684903474800
20.24769245549056900
20.86290566493141800
21.48809860438767000
22.12327319925893600
22.76843119236028200
23.42357416118141700
24.08870353352444100
24.76382060167068700
25.44892653521333200
26.14402239268058600
26.84910913206203600
27.56418762034115800
28.28925864212687100
29.02432290746915600
29.76938105893477300
30.52443367801369700
31.28948129091804700
32.06452437383219900
32.84956335766470700
33.64459863234981900
34.44963055074094900
35.26465943213449300
36.08968556545946200
36.92470921216401100
37.76973060882801300
38.62474996952748500
39.48976748797428400
40.36478333945273500
41.24979768257178800
42.14481066085129900
43.04982240415675700
43.96483302999838100
44.88984264470612100
45.82485134449326800
46.76985921641880100
47.72486633925829800
48.68987278429185000
49.66487861601729700
50.64988389279533700
51.64488866743355500
52.64989298771470100
53.66489689687471600
54.68990043403561400
55.72490363459656500
56.76990653058823700
57.82490915099347700
58.88991152203711700
59.96491366744862700
61.04991560869915200
62.14491736521691900
63.24991895458124000
64.36492039269866400
65.48992169396197500
66.62492287139447500
67.76992393677998900
68.92492490078120700
70.08992577304596200
71.26492656230405500
72.44992727645464500
73.64492792264495300
74.84992850734232700
76.06492903639856700
77.28992951510865300
78.52492994826342000
79.76993034019820100
81.02493069483546200
82.28993101572459100
83.56493130607715600
84.84993156879909300
86.14493180651969300
87.44993202161825300
88.76493221624744500
90.08993239235528000
91.42493255170430200
92.76993269588918200
94.12493282635308800
95.48993294440171600
96.86493305121655300
98.24993314786667000
99.64493323531918600
101.04993331444962000
102.46493338604972000
103.88993345083621000
105.32493350945740000
106.76993356250013000
108.22493361049507000
109.68993365392275000
111.16493369321779000
112.64993372877339000
114.14493376094546000
115.64993379005580000
117.16493381639603000
118.68993384022964000
120.22493386179522000
121.76993388130843000
123.32493389896493000
124.88993391494100000
126.46493392939679000
128.04993394247697000
129.64493395431234000
131.24993396502148000
132.86493397471151000
134.48993398347955000
136.12493399141309000
137.76993399859160000
139.42493400508712000
141.08993401096433000
142.76493401628247000
144.44993402109424000
146.14493402544838000
147.84993402938824000
149.56493403295275000
151.28993403617847000
153.02493403909702000
154.76993404173780000
156.52493404412746000
158.28993404628943000
160.06493404824587000
161.84993405001620000
163.64493405161801000
165.44993405306741000
167.26493405437867000
169.08993405556538000
170.92493405663905000
172.76993405761070000
174.62493405848974000
176.48993405928519000
178.36493406000488000
180.24993406065613000
182.14493406124555000
184.04993406177857000
185.96493406226114000
187.88993406269753000
189.82493406309266000
191.76993406345002000
193.72493406377347000
195.68993406406611000
197.66493406433094000
199.64993406457052000
201.64493406478724000
203.64993406498360000
205.66493406516096000
207.68993406532161000
209.72493406546687000
211.76993406559853000
213.82493406571743000
215.88993406582520000
217.96493406592259000
220.04993406601074000
222.14493406609051000
224.24993406616269000
226.36493406622816000
228.48993406628716000
230.62493406634070000
232.76993406638917000
234.92493406643283000
237.08993406647244000
239.26493406650849000
241.44993406654078000
243.64493406657013000
245.84993406659677000
248.06493406662099000
250.28993406664262000
252.52493406666244000
254.76993406668007000
257.02493406669623000
259.28993406671083000
261.56493406672416000
263.84993406673630000
266.14493406674683000
268.44993406675684000
270.76493406676559000
273.08993406677365000
275.42493406678113000
277.76993406678747000
280.12493406679357000
282.48993406679870000
284.86493406680358000
287.24993406680818000
289.64493406681220000
292.04993406681609000
294.46493406681918000
296.88993406682209000
299.32493406682471000
301.76993406682715000
304.22493406682958000
306.68993406683143000
309.16493406683321000
311.64993406683504000
314.14493406683641000
316.64993406683766000
319.16493406683873000
321.68993406684041000
324.22493406684112000
326.76993406684227000
329.32493406684296000
331.88993406684398000
334.46493406684448000
337.04993406684491000
339.64493406684568000
342.24993406684632000
344.86493406684667000
347.48993406684730000
350.12493406684791000
352.76993406684824000
355.42493406684827000
358.08993406684874000
360.76493406684887000
363.44993406684955000
366.14493406684943000
368.84993406684947000
371.56493406684990000
374.28993406685032000
377.02493406685028000
379.76993406685000000
382.52493406685073000
385.28993406685083000
388.06493406685092000
390.84993406685101000
393.64493406685091000
396.44993406685148000
399.26493406685148000
402.08993406685158000
404.92493406685156000
407.76993406685119000
410.62493406685172000
413.48993406685179000
416.36493406685190000
419.24993406685206000
422.14493406685204000
425.04993406685219000
427.96493406685209000
430.88993406685239000
433.82493406685211000
436.76993406685261000
439.72493406685203000
442.68993406685274000
445.66493406685237000
448.64993406685272000
451.64493406685307000
454.64993406685255000
457.66493406685277000
460.68993406685303000
463.72493406685300000
466.76993406685318000
469.82493406685296000
472.88993406685330000
475.96493406685346000
479.04993406685327000
482.14493406685347000
485.24993406685354000
488.36493406685389000
491.48993406685355000
494.62493406685388000
497.76993406685364000
500.92493406685384000
504.08993406685380000
507.26493406685421000
510.44993406685393000
513.64493406685392000
516.84993406685430000
520.06493406685445000
523.28993406685436000
526.52493406685448000
529.76993406685426000
533.02493406685437000
536.28993406685413000
539.56493406685456000
542.84993406685487000
546.14493406685506000
549.44993406685501000
552.76493406685552000
556.08993406685522000
559.42493406685469000
562.76993406685517000
566.12493406685451000
569.48993406685565000
572.86493406685520000
576.24993406685530000
579.64493406685585000
583.04993406685537000
586.46493406685590000
589.88993406685552000
593.32493406685580000
596.76993406685517000
600.22493406685624000
603.68993406685672000
607.16493406685629000
610.64993406685653000
614.14493406685574000
617.64993406685630000
621.16493406685640000
624.68993406685649000
628.22493406685714000
631.76993406685654000
635.32493406685694000
638.88993406685699000
642.46493406685647000
646.04993406685696000
649.64493406685676000
653.24993406685712000
656.86493406685679000
660.48993406685702000
664.12493406685746000
667.76993406685722000
671.42493406685696000
675.08993406685772000
678.76493406685722000
682.44993406685728000
686.14493406685722000
689.84993406685828000
693.56493406685797000
697.28993406685777000
701.02493406685835000
704.76993406685824000
708.52493406685812000
712.28993406685731000
716.06493406685831000
719.84993406685896000
723.64493406685835000
727.44993406685921000
731.26493406685847000
735.08993406685829000
738.92493406685912000
742.76993406685835000
746.62493406685894000
750.48993406685906000
754.36493406685895000
758.24993406685951000
762.14493406685870000
766.04993406686026000
769.96493406685988000
773.88993406685938000
777.82493406685933000
781.76993406685938000
785.72493406685987000
789.68993406685979000
793.66493406686027000
797.64993406686017000
801.64493406686017000
805.64993406686040000
809.66493406686016000
813.68993406686059000
817.72493406686044000
821.76993406686040000
825.82493406686035000
829.88993406686052000
833.96493406686091000
838.04993406686071000
842.14493406686120000
846.24993406686110000
850.36493406686134000
854.48993406686179000
858.62493406686065000
862.76993406686120000
866.92493406686140000
871.08993406686113000
875.26493406686188000
879.44993406686262000
883.64493406686165000
887.84993406686181000
892.06493406686184000
896.28993406686277000
900.52493406686210000
904.76993406686233000
909.02493406686324000
913.28993406686243000
917.56493406686207000
921.84993406686237000
926.14493406686347000
930.44993406686376000
934.76493406686291000
939.08993406686341000
943.42493406686310000
947.76993406686302000
952.12493406686394000
956.48993406686338000
960.86493406686373000
965.24993406686349000
969.64493406686427000
974.04993406686344000
978.46493406686443000
982.88993406686450000
987.32493406686444000
991.76993406686495000
996.22493406686488000
1000.68993406686450000
1005.16493406686490000
1009.64993406686440000
1014.14493406686440000
1018.64993406686600000
1023.16493406686500000
1027.68993406686580000
1032.22493406686660000
1036.76993406686550000
1041.32493406686490000
1045.88993406686560000
1050.46493406686550000
1055.04993406686820000
1059.64493406686730000
1064.24993406686580000
1068.86493406686580000
1073.48993406686510000
1078.12493406686870000
1082.76993406686640000
1087.42493406686590000
1092.08993406686590000
1096.76493406686720000
1101.44993406686830000
1106.14493406686640000
1110.84993406686570000
1115.56493406686810000
1120.28993406686820000
1125.02493406686680000
1129.76993406686530000
1134.52493406686720000
1139.28993406686820000
1144.06493406686830000
1148.84993406686910000
1153.64493406686800000
1158.44993406686970000
1163.26493406686880000
1168.08993406686860000
1172.92493406686800000
1177.76993406686850000
1182.62493406686920000
1187.48993406686710000
1192.36493406686900000
1197.24993406686920000
1202.14493406686890000
1207.04993406687120000
1211.96493406687050000
1216.88993406686930000
1221.82493406687040000
1226.76993406686760000
1231.72493406686750000
1236.68993406687060000
1241.66493406687230000
1246.64993406687110000
1251.64493406686920000];

for i = 1:length(y)
    I_precesion_minus(i) = gamma(k+1)*y_minus(i).*(sum(a.*(y_minus(i).^n))/sum(b.*(y_minus(i).^m))).^k;
    I_precesion(i) = x(i)^2/2 + 2*I_precesion_minus(1) - I_precesion_minus(i);
    
    % Для страховки добавим 10^-17
    delta(i) = log10(abs(I_approximate(i)/I_precesion(i)-1) + 10^-17);
end

x_minus = -10:0.1:0;
y_minus = log(1 + exp(x_minus));

I_precesion_minus = [];

for i = 1:length(y_minus)
    I_precesion_minus(i) = gamma(k+1)*y_minus(i).*(sum(a.*(y_minus(i).^n))/sum(b.*(y_minus(i).^m))).^k;
    
    % Для страховки добавим 10^-17
    delta_minus(i) = log10(abs(I_approximate_minus(i)/I_precesion_minus(i)-1) + 10^-17);
end

disp('delta = ');
disp((delta)');
grid on, hold on
plot(x, delta, '*')
plot(x_minus, delta_minus, '*')